# cfgserver
【星控】基于 Butterfly 框架 + raft 协议实现一个 Redis 集群的管控服务
<!-- vim-markdown-toc GFM -->

* [1 前言](#1-前言)
    * [1.1 Arch](#11-arch)
    * [1.2 功能](#12-功能)
* [2 调研](#2-调研)
    * [2.1 cc](#21-cc)
        * [2.1.1 路由管理](#211-路由管理)
        * [2.1.2 单机止损](#212-单机止损)
        * [2.1.3 集群扩缩容](#213-集群扩缩容)
        * [2.1.4 自身高可用](#214-自身高可用)
    * [2.2 mongodb](#22-mongodb)
* [3 wiki](#3-wiki)

<!-- vim-markdown-toc -->

# 1 前言

## 1.1 Arch

```
  +---------+     +---------+     +---------+         +-------------------+
  |twemproxy|     |twemproxy|     |twemproxy|         |                   |
  +---------+     +---------+     +---------+    \    |  +-------------+  |
        | \          /   \          /  |          \   |  |cfg primary  |  |
        |    \     /       \     /     |           \  |  +-------------+  |
        |       X             X        |            \ |                   |
        |    /     \       /     \     |             \|  +-------------+  |
        |  /          \ /          \   |              |  |cfg secondary|  |
  +------------------+   +------------------+        /|  +-------------+  |
  |    +--------+    |   |    +--------+    |       / |                   |
  |    | master |    |   |    | master |    |      /  |  +-------------+  |
  |    +--------+    |   |    +--------+    |     /   |  |cfg secondary|  |
  | +-----+  +-----+ |   | +-----+  +-----+ |    /    |  +-------------+  |
  | |slave|  |slave| |   | |slave|  |slave| |         |                   |
  | +-----+  +-----+ |   | +-----+  +-----+ |         |                   |
  +------------------+   +------------------+         +-------------------+
```

## 1.2 功能

> * 路由管理
> * 单机止损
> * 集群扩缩容
> * 配置管理

# 2 调研

## 2.1 cc

https://github.com/meetbill/cc

### 2.1.1 路由管理

拓扑信息由 redis cluster 进行维护

### 2.1.2 单机止损

感知层及决策层由 redis cluster 处理

cc 获取一致的拓扑信息，然后进行执行操作，即 cc 主要负责执行层

### 2.1.3 集群扩缩容

通过下发命令到 redis cluster 集群进行迁移 slot 进行扩缩容

### 2.1.4 自身高可用

拓扑信息在 redis cluster 中，本身是无状态节点，通过主备方式实现（部署多个节点，然后在 zookeeper 上进行注册抢主）

## 2.2 mongodb

https://github.com/mongodb/mongo

# 3 wiki

https://github.com/meetbill/cfgserver/wiki
